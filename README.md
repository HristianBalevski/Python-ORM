# Python-ORM
Python ORM course at SoftUni - October 2023

[Click Here for more information about the course Python ORML](https://softuni.bg/trainings/4253/python-orm-october-2023)

![exhausted-young-male-software-developer-sleeping-by-technology-while-leaning-desk](https://github.com/HristianBalevski/Python-ORM/assets/114162692/961bbbcc-673b-4e53-8426-fd8e006bed46)

## 01.ORM INTRODUCTION

## What is ORM?

- Object-Relational Mapping (ORM) allows manipulating databases using common classes and objects
- Python Classes ➔ Database Tables

## Benefits of ORM

- Enables you to write code in your preferred OOP language
- Provides a layer of abstraction that hides the complexity of the database schema and relationships
- Can automate some common tasks:
  - Creating, updating, and deleting records
  - Validating data
  - Managing transactions and connections

## Drawbacks of ORM

- When it comes to complex queries and aggregations that require high performance and flexibility
- Can generate inefficient or suboptimal SQL queries
  - Poor performance
  - Excessive memory usage
  - Unexpected errors

- Limits control and customization over the SQL queries and operations
  - Harder to optimize
  - May not support some advanced features or functions

## SQL Injection

- SQL Injection is a type of an injection attack
- Makes it possible to execute malicious SQL statements
- Attackers can use SQL Injection vulnerabilities to bypass application security measures so they could:
  - go around authentication and authorization
  - retrieve the content of the entire database
  - add, modify, and delete records in the database
  - gain unauthorized access to sensitive data
- ORM reduces explicit SQL queries and is much less vulnerable to SQL injection

## ORM Advantages and Disadvantages

**Advantages**
- Developer productivity – speeds up development
- SQL injection is a lot more difficult
- ORMs work very well with CRUD
- Better readability

**Disadvantages**
- Reduced performance (N+1 issue or autogenerated SQL)
- Reduces flexibility (some operations are hard to implement)

## Popular ORM Tools for Python

- Django
  - A great tool for building web applications rapidly
- web2py
  - An open source full-stack Python framework 
- SQLObject
  - An ORM that provides an object interface to your database 
- SQLAlchemy
  - Provides persistence patterns designed for efficient and high - performing database access
 
## Database Drivers

- Database Driver (module/connector) is a computer program that implements a protocol for a database connection
  - Works like an adapter that connects a generic interface to a specific database vendor implementation
  - Accesses the physical data through a stand-alone engine
  - Submits SQL statements to and retrieves results from the engine
 
## Psycopg2

- PostgreSQL database adapter for Python programming language
- Use Psycopg2 module to
  - Connect to PostgreSQL
  - Perform SQL queries and database operations
- Psycopg2 is an external module

## Psycopg2 Advantages

- Preferred module for PostgreSQL interaction
- Trusted by Python and PostgreSQL frameworks
- Actively maintained
- Fully supports Python's primary versions, ensuring seamless integration
- Thread-safe design built to ensure safe and reliable operation
- Designed to handle heavy multi-threaded applications

## Django & Django ORM

**What is Framework?**

- Platform for developing software applications
- Provides a foundation on which software developers can build programs for a specific platform
- A framework includes an API
- May include code libraries, a compiler, and other programs used in the software development process

**What is Django Framework?**

- High-level Python Web Framework
- Ridiculously fast
- Reassuringly secure
- Exceedingly scalable
- Free and Open Source

**Django ORM**

- Django is equipped with an ORM
- One of the best ORMs available in the industry today
- Tightly coupled with the Django framework
- Very efficient
- Ability to handle medium to low complexity queries and medium to huge datasets
- Migrations are another useful feature

## Django Application

**App vs Project**

- Django App:
  - A Web application that does something - e.g., a blog system or a small task app
  - One app can be used in multiple projects
 
- Django Project:
  - A collection of configuration and apps for a particular website
  - The project can contain multiple apps
 
## Directory Structure

- admin.py
  - The admin site module
- models.py
  - The models of the app
- views.py
  - The views of the app
- migrations
  - Command-line utility for propagating changes in models
 
## Django dbshell

**Django dbshell**

- An interactive command-line interface shell environment
- Runs the command-line client for specified database, or the default database
- A very useful tool for SQL database debugging when working on a Django application

---
## 02.DJANGO MODELS BASICS

- Models define the structure of stored data
  - Containing the essential fields and behaviors of the data
- Each model maps to a single database table
- Django Model is a Python class that subclasses **django.db.models.Model**
- Each attribute of the model represents a database field

**Models Benefits**

- Work with database data using Python code
  - Don't have to write low-level SQL queries
  - Focus on the data and the business logic
  - Django automatically creates the needed queries and executes them
 
**Defining a Model**

- Еach Django application has a models.pyfile
- Create your model there. You need to subclass models.Model
```
from django.db import models


class Task(models.Model):
    title = models.CharField(max_length=50)
    text = models.TextField()
```
**Fields**

- The most important and required part of a model
  - Field names should not conflict with reserved words
  - Field names cannot have more than one underscore in a row and cannot end with an underscore

- Each field is an instance of the appropriate Field class
```
class Employee(models.Model):
    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
```
**Field Types**

- They determine the column type in a database table (e.g., INTEGER, VARCHAR, TEXT)
- Django has dozens of built-in field types
- Technically, they are defined in **django.db.models.fields**
- For convenience they're imported into **django.db.models**
```
from django.db import models


class Employee(models.Model):
    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
```
**String Field Types**

- CharField
  - Appropriate for small- to large-sized strings
  - Has one extra argument - max_length(required for all database backends included with Django except PostgreSQL)
 
- TextField
  - Appropriate for large texts
  - When specifying max length, it won't be enforced at the model or database level

- IntegerField
  - Stores integers
 
- PositiveIntegerField
  - Stores integers that could be either positive or zero

- FloatField
  - Stores floating-point numbers

- DecimalField
  - Stores fixed-precision decimal numbers
  - Two required arguments - **max_digits** and **decimal_place**
 
**Date/Time Field Types**

- DateField - stores a date
- TimeField - stores a time
- DateTimeField - stores a date and a time
- They have two extra field arguments (not required):
  - auto_now
    - Sets the field to now every time the object is saved
  - auto_now_add
    - Sets the field to now when the object is first created
   
**More Useful Field Types**

- BooleanField
  - Stores Booleans - either Trueor False
- URLField
  - CharField for URLs
  - max_lengthis 200 by default
- EmailField
  - CharField that **checks** if the value is a **valid email address**
  - max_lengthis 254 by default
- Field Arguments
  - A certain set of field-specific or common arguments
    - max_length argument specifies the size of the VARCHAR field. It is a field-specific, required argument
    - null, blank, default, primary_key, etc. are **common optional** arguments
- If you do not specify primary_key=True for any field in your model, Django will automatically add an IntegerField to hold the primary key

**Model vs SQL Query**

- Creating model **Employee** in the app **employees**
```
class Employee(models.Model):
    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
```
- It will create a database table like the following
```
CREATE TABLE employees_employee (
"id" BIGINT NOT NULL PRIMARY KEY,
"first_name" VARCHAR(30) NOT NULL,
"last_name" VARCHAR(40) NOT NULL
);
```

**Model Field Options in Details**

- Field Options
  - Common SQL constraints but in Python code
  - Available for all field types
  - All of them are optional
 
**Default vs Unique**

- default
  - A default value or a default callable object for the field
- unique
  - False by default
  - If True, this field must be unique for the table column
  ```
  class Employee(models.Model):
    ...
    works_full_time = models.BooleanField(default=True)
    job_level = models.CharField(max_length=30, default='Junior')
    business_account = models.CharField(max_length=30, unique=True)
```




